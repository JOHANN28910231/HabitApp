<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Panel del anfitrión — Habitaciones — HabitApp</title>

    <!-- Tu CSS del proyecto -->
    <link rel="stylesheet" href="../css/styles.css">

    <!-- Bootstrap CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-site">

    <header class="site-header">
        <nav class="container navbar navbar-expand-lg">
            <a class="navbar-brand d-flex align-items-center" href="/HabitApp/public" aria-label="HabitApp - Inicio">
                <img src="/multimedia/tizihause.jpg" alt="HabitApp logo" class="brand-img">
            </a>

            <div class="ms-auto d-flex align-items-center gap-2">
                <span id="userName" class="me-2"></span>
                <button id="logoutBtn" class="btn btn-light btn-sm rounded-pill">Cerrar sesión</button>
            </div>
        </nav>
    </header>

    <main class="container py-4">
        <h3 class="section-title">Gestión de Habitaciones</h3>

        <div class="row g-3 mt-3">
            <div class="col-12 col-md-6">
                <label for="propertySelect" class="form-label fw-semibold">Seleccionar propiedad</label>
                <select id="propertySelect" class="form-select form-control-custom">
                    <option value="">-- Elige una propiedad --</option>
                    <!-- Opciones pobladas por JS -->
                </select>
            </div>

            <div class="col-12 col-md-6 d-flex align-items-end justify-content-end gap-2">
                <button id="btnAbrirCrearRoom" class="btn btn-accent" disabled>Añadir habitación</button>
            </div>
        </div>

        <div class="mt-4">
            <h5 class="mb-3" id="propertyTitle">Habitaciones</h5>

            <!-- Contenedor de lista de habitaciones -->
            <div id="roomsList" class="row gy-3">
                <!-- Cada habitación será una card dentro de una columna -->
                <!-- HTML de ejemplo (eliminar / reemplazar con JS):
            <div class="col-12 col-md-6 col-lg-4">
              <div class="card">
                <div class="card-body">
                  <h6 class="card-title">Habitación #1</h6>
                  <p class="card-text small">Descripción...</p>
                  <ul class="list-unstyled small">
                    <li>Capacidad: 2</li>
                    <li>Precio noche: $500.00</li>
                    <li>Precio semana: $3000.00</li>
                    <li>Precio mes: $8000.00</li>
                    <li>Estado: activa</li>
                  </ul>
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-primary btn-edit-room" data-id="1">Editar</button>
                    <button class="btn btn-sm btn-outline-danger btn-delete-room" data-id="1">Eliminar</button>
                  </div>
                </div>
              </div>
            </div>
            -->
            </div>

            <!-- Estado vacío -->
            <div id="roomsEmptyState" class="alert alert-info mt-3 d-none">
                No hay habitaciones para la propiedad seleccionada. Pulsa <strong>"Añadir habitación"</strong> para
                crear la primera.
            </div>
        </div>
    </main>

    <!-- Modal: Crear / Editar Habitación -->
    <div class="modal fade" id="modalRoom" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body p-4">
                    <button type="button" class="btn-close float-end" data-bs-dismiss="modal"
                        aria-label="Cerrar"></button>
                    <h2 class="h5 fw-bold mb-3" id="modalRoomTitle">Crear habitación</h2>

                    <form id="formRoom" novalidate>
                        <!-- id_habitacion se usa para editar -->
                        <input type="hidden" id="id_habitacion" name="id_habitacion">
                        <!-- id_propiedad se llena cuando se abre el modal (propiedad seleccionada) -->
                        <input type="hidden" id="id_propiedad_hidden" name="id_propiedad">

                        <div class="mb-3">
                            <label for="descripcion" class="form-label fw-semibold">Descripción</label>
                            <textarea id="descripcion" name="descripcion" class="form-control form-control-custom"
                                rows="3" required></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Servicios incluidos</label>
                            <div id="servicesContainer" class="d-flex flex-wrap gap-2">
                                <!-- Checkboxes de servicios poblados por JS -->
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="roomPhotos" class="form-label fw-semibold">Fotos de la habitación</label>
                            <input
                                    id="roomPhotos"
                                    name="photos"
                                    type="file"
                                    class="form-control form-control-custom"
                                    multiple
                                    accept="image/*">
                            <div class="form-text small">
                                Puedes subir varias fotos (JPG, PNG, WEBP, GIF).
                            </div>
                        </div>



                        <div class="row g-3">
                            <div class="col-12 col-md-4">
                                <label for="capacidad" class="form-label fw-semibold">Capacidad máxima</label>
                                <input id="capacidad" name="capacidad" type="number"
                                    class="form-control form-control-custom" min="1" required>
                            </div>

                            <div class="col-12 col-md-4">
                                <label for="precioNoche" class="form-label fw-semibold">Precio por noche</label>
                                <input id="precioNoche" name="precioNoche" type="number" step="0.01"
                                    class="form-control form-control-custom" min="0" required>
                            </div>

                            <div class="col-12 col-md-4">
                                <label for="precioSemana" class="form-label fw-semibold">Precio por semana</label>
                                <input id="precioSemana" name="precioSemana" type="number" step="0.01"
                                    class="form-control form-control-custom" min="0">
                            </div>

                            <div class="col-12 col-md-4">
                                <label for="precioMes" class="form-label fw-semibold">Precio por mes</label>
                                <input id="precioMes" name="precioMes" type="number" step="0.01"
                                    class="form-control form-control-custom" min="0">
                            </div>

                            <div class="col-12 col-md-4">
                                <label for="estado_habitacion" class="form-label fw-semibold">Estado</label>
                                <select id="estado_habitacion" name="estado_habitacion"
                                    class="form-select form-control-custom">
                                    <option value="activa">Activa</option>
                                    <option value="inactiva">Inactiva</option>
                                </select>
                            </div>
                        </div>

                        <div class="d-flex gap-2 justify-content-end mt-4">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-accent" id="btnSaveRoom">Guardar habitación</button>
                        </div>
                    </form>
                    <!-- Sección: Bloqueos por mantenimiento -->
                    <hr>
                    <div class="mt-3">
                        <h6 class="fw-semibold">Bloqueos por mantenimiento</h6>
                        <p class="small text-muted">Agrega rangos de fechas para bloquear la habitación (mantenimiento,
                            reservado por propietario, etc.).</p>

                        <div class="row g-2 align-items-end">
                            <div class="col-12 col-md-3">
                                <label for="blockStart" class="form-label small">Fecha inicio</label>
                                <input id="blockStart" type="date" class="form-control form-control-sm">
                            </div>
                            <div class="col-12 col-md-3">
                                <label for="blockEnd" class="form-label small">Fecha fin</label>
                                <input id="blockEnd" type="date" class="form-control form-control-sm">
                            </div>
                            <div class="col-12 col-md-4">
                                <label for="blockReason" class="form-label small">Motivo (opcional)</label>
                                <input id="blockReason" type="text" class="form-control form-control-sm"
                                    placeholder="Ej. Mantenimiento de aire acondicionado">
                            </div>
                            <div class="col-12 col-md-2 d-grid">
                                <button id="btnAddBlock" type="button" class="btn btn-outline-primary btn-sm">Agregar
                                    bloqueo</button>
                            </div>
                        </div>

                        <div class="mt-2">
                            <div id="blocksList" class="list-group list-group-flush small">
                                <!-- Lista de bloqueos existentes y pendientes -->
                            </div>
                            <small class="text-muted">Los bloqueos se guardan al crear/actualizar la habitación.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Confirmar eliminación -->
    <div class="modal fade" id="modalConfirmDeleteRoom" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body p-4 text-center">
                    <h5 class="mb-3">¿Eliminar habitación?</h5>
                    <p class="small text-muted">Esta acción es irreversible. Si prefieres, puedes cambiar el estado a
                        "inactiva".</p>
                    <input type="hidden" id="id_habitacion_delete">
                    <div class="d-flex justify-content-center gap-2 mt-3">
                        <button class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                        <button id="confirmDeleteRoomBtn" class="btn btn-danger">Eliminar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer mt-4">
        <div class="container text-center py-3">
            © <span id="year-rooms"></span> HabitApp — Gestión de habitaciones
        </div>
    </footer>

    <!-- Bootstrap JS bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Tu JS: implementa fetch/CRUD -->
    <!-- Asegúrate de que rooms.js use los IDs y clases del HTML (propertySelect, btnAbrirCrearRoom, roomsList, modalRoom, formRoom, etc.) -->
    <script src="/js/rooms.js" defer></script>

    <!-- Fecha dinámica -->
    <script>
        document.getElementById('year-rooms').innerText = new Date().getFullYear();
    </script>

</body>

</html>


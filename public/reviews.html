<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tu Reseña | TiziHause</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="reviews-page-container">
        <div class="reviews-page-card">
            <!-- MODO: DEJAR RESEÑA (CON TOKEN) -->
            <section id="review-mode" class="hidden">
                <h1 class="reviews-page-title">¡Comparte tu experiencia!</h1>
                <p class="reviews-page-subtitle">
                    Tu opinión es muy valiosa y ayuda a otros viajeros a tomar mejores decisiones.
                </p>

                <!-- Mensaje de error -->
                <div id="errorBox" class="review-alert review-alert-error hidden"></div>

                <!-- Información de la reserva -->
                <div id="tokenInfoSection" class="reservation-info-box hidden">
                    <p id="tokenInfoText"></p>
                </div>

                <!-- Formulario de reseña -->
                <form id="reviewForm" class="hidden">
                    <!-- Calificación con estrellas -->
                    <div class="star-rating-container">
                        <label class="star-rating-label">¿Cómo calificarías tu estancia?</label>
                        <div class="star-rating" id="starRating">
                            <span data-value="1">★</span>
                            <span data-value="2">★</span>
                            <span data-value="3">★</span>
                            <span data-value="4">★</span>
                            <span data-value="5">★</span>
                        </div>
                        <input type="hidden" id="rating" name="rating" value="0" required />
                        <span class="star-rating-hint">Haz clic en las estrellas para calificar (1 = Malo, 5 = Excelente)</span>
                    </div>

                    <!-- Título de la reseña -->
                    <div class="review-form-group">
                        <label class="review-form-label" for="titulo">Título de tu reseña</label>
                        <input 
                            type="text" 
                            id="titulo" 
                            name="titulo"
                            class="review-form-input" 
                            placeholder="Resume tu experiencia en pocas palabras"
                            maxlength="100" 
                            required 
                        />
                        <span class="review-form-hint">Máximo 100 caracteres</span>
                    </div>

                    <!-- Comentario detallado -->
                    <div class="review-form-group">
                        <label class="review-form-label" for="comentario">Cuéntanos más sobre tu estancia</label>
                        <textarea 
                            id="comentario" 
                            name="comentario" 
                            class="review-form-textarea" 
                            placeholder="¿Qué te gustó más? ¿Qué podríamos mejorar? Comparte los detalles de tu experiencia..."
                            maxlength="500" 
                            required
                        ></textarea>
                        <span class="review-form-hint">
                            <span class="review-char-count"><span id="charCount">0</span>/500</span>
                            Describe tu experiencia con detalle
                        </span>
                    </div>

                    <!-- Botón de envío -->
                    <div class="review-form-group">
                        <button type="submit" class="review-submit-btn" id="submitBtn">
                            Enviar mi reseña
                        </button>
                    </div>
                </form>
            </section>

            <!-- MODO: ACCESO NO VÁLIDO (SIN TOKEN) -->
            <section id="no-token-mode" class="hidden">
                <h1 class="reviews-page-title">Acceso Restringido</h1>
                <div class="review-alert review-alert-info">
                    <p><strong>⚠️ Esta página es solo para huéspedes invitados</strong></p>
                    <p>Para dejar una reseña, necesitas un enlace especial que se envía automáticamente a tu correo electrónico después de tu estancia.</p>
                    <p>Si completaste una reservación recientemente, revisa tu bandeja de entrada (y la carpeta de spam).</p>
                </div>
                
                <div style="text-align: center; margin-top: 32px;">
                    <a href="/" class="review-submit-btn" style="display: inline-block; text-decoration: none; width: auto; padding: 14px 32px;">
                        Volver al inicio
                    </a>
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="reviews-page-footer">
            <p>&copy; <span id="currentYear"></span> TiziHause - Todos los derechos reservados</p>
            <p style="margin-top: 8px; font-size: 12px;">Gracias por confiar en nosotros</p>
        </footer>
    </div>

    <script src="/js/reviews.js"></script>
</body>
</html>
